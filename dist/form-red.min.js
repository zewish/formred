!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react"),require("react-redux")):"function"==typeof define&&define.amd?define(["exports","react","react-redux"],r):r(e.FormRed=e.FormRed||{},e.React,e.ReactRedux)}(this,function(e,r,t){"use strict";function o(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function n(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function u(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function i(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function c(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function a(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function f(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function s(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}var l="default"in r?r.default:r,p="@@formRed",y=p+"_CREATE",d=p+"_DESTROY",m=p+"_ADD",v=p+"_REMOVE",b=p+"_SET",h=p+"_SET_ALL",O=p+"_TOUCH",g=p+"_UNTOUCH",E=p+"_TOUCH_ALL",j=p+"_UNTOUCH_ALL",T=p+"_SUBMIT",_=p+"_SUBMIT_END",R=p+"_FORM_ERROR",P=p+"_FIELD_ERROR",S=p+"_RESET",A=function(e,r){return{type:y,payload:{formName:e,opts:r}}},w=function(e){return{type:d,payload:{formName:e}}},N=function(e,r,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"text";return{type:m,payload:{formName:e,fieldName:r,fieldValue:t,fieldType:o}}},k=function(e,r){return{type:v,payload:{formName:e,fieldName:r}}},x=function(e,r,t){return{type:b,payload:{formName:e,fieldName:r,fieldValue:t}}},C=function(e,r){return{type:h,payload:{formName:e,values:r}}},U=function(e,r){return{type:O,payload:{formName:e,fieldName:r}}},D=function(e,r){return{type:g,payload:{formName:e,fieldName:r}}},L=function(e){return{type:E,payload:{formName:e}}},F=function(e){return{type:j,payload:{formName:e}}},M=function(e){return{type:T,payload:{formName:e}}},W=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return{type:_,payload:{formName:e,formError:r,fieldErrors:t}}},q=function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return{type:S,payload:{formName:e,full:r}}},B=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{type:R,payload:{formName:e,error:r}}},H=function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return{type:P,payload:{formName:e,fieldName:r,error:t}}},I=Object.freeze({PREFIX:p,CREATE:y,DESTROY:d,ADD:m,REMOVE:v,SET:b,SET_ALL:h,TOUCH:O,UNTOUCH:g,TOUCH_ALL:E,UNTOUCH_ALL:j,SUBMIT:T,SUBMIT_END:_,FORM_ERROR:R,FIELD_ERROR:P,RESET:S,create:A,destroy:w,add:N,remove:k,set:x,setAll:C,touch:U,untouch:D,touchAll:L,untouchAll:F,submit:M,submitEnd:W,reset:q,formError:B,fieldError:H}),V=(e,r,t)=>{let o=r.replace(/\[/g,".").replace(/\]/g,"").replace(/^\./,"").split(".").reduce((e,r)=>{return e&&e[r]},e);return void 0===o?t:o},Y=(e,r,t)=>{let o=r.replace(/\[/g,".").replace(/\]/g,"").replace(/^\./,"").split(".");return o.reduce((e,r,n)=>{return"object"!=typeof e[r]&&(e[r]={}),o.length===n+1&&(e[r]=t),e[r]},e||{}),e},z=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=[].concat(r).reduce(function(e,r){return e[r]=!0,e},{});return Object.keys(e||{}).reduce(function(r,o){return t[o]||(r[o]=e[o]),r},{})},X=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J=function(e){var r=e.fields,t=e.values,o=e.opts,n=e.opts.validate(t,o);return"object"!=("undefined"==typeof n?"undefined":G(n))?e:(e.errors=null,Object.keys(r).forEach(function(t){var o=V(n,t,n[t]||null);o&&(e.errors=e.errors||{},Y(e.errors,t,o)),e.fields[t]=X({},r[t]||{},{error:o})}),e)},K=function(e){return"checkbox"!=e&&"radio"!=e&&""},Q=function(e){if(!e||!e.stopPropagation||!e.preventDefault)return e;switch(e.target.type){case"radio":case"checkbox":return e.target.checked;case"file":return e.target.files||V(e,"dataTransfer.files")}return e.target.value},Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},ee={touched:!1,error:null,type:"text"},re=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments[2];return Object.keys(e).reduce(function(o,n){return n===t?o:(Y(o,n,V(r,n)||K(e[n].type)),o)},{})},te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments[1],t=r.type,n=r.payload,u=V(n,"formName"),i=V(n,"fieldName"),c=V(e,""+(u||""),{opts:{},fields:{},values:{},submitting:!1,errors:null,error:null}),a=V(c,"fields",{}),f=V(c,"values",{}),s=function(){switch(t){case y:var r=V(n,"opts",{});return{v:$({},e,o({},u,e[u]||$({},c,{values:r.values?re(a,r.values):{},opts:r})))};case d:return{v:$({},z(e,u))};case m:return void 0===V(f,i)&&Y(c.values,""+i,n.fieldValue),c.fields=$({},a,o({},i,a[i]||$({},ee,{type:n.fieldType}))),{v:$({},e,o({},u,$({},J(c))))};case v:return c.fields=z(a,i),c.values=re(a,f,i),{v:$({},e,o({},u,$({},J(c))))};case b:return Y(c.values,""+i,n.fieldValue),{v:$({},e,o({},u,$({},J(c))))};case h:return f=re(a,n.values),{v:$({},e,o({},u,$({},J($({},c,{values:f,opts:$({},c.opts||{},{values:f})})))))};case O:case g:if(!a[i])return{v:e};var s=a[i];return s.touched=t==O,{v:$({},e,o({},u,$({},c,{fields:$({},a,o({},i,s))})))};case E:case j:return a=Object.keys(a).reduce(function(e,r){return e[r]=$({},e[r],{touched:t==E}),e},a),{v:$({},e,o({},u,$({},c,{fields:a})))};case T:return{v:$({},e,o({},u,$({},c,{submitting:!0})))};case _:var l=n.fieldErrors;return l&&(a=Object.keys(a).reduce(function(e,r){var t=V(l,r);return t?(e[r].error=t,c.errors=c.errors||{},Y(c,"errors."+r,n.error),e):e},a),c=$({},c,{fields:a})),{v:$({},e,o({},u,$({},c,{submitting:!1,error:n.formError})))};case S:return a=Object.keys(a).reduce(function(e,r){return e[r]=$({},ee,{type:a[r].type}),e},{}),f=c.opts.values,n.full&&(f=Object.keys(a).reduce(function(e,r){return Y(e,r,K(a[r].type)),e},{})),{v:$({},e,o({},u,J($({},c,{fields:a,values:f,submitting:!1,error:null}))))};case R:return{v:$({},e,o({},u,$({},c,{error:n.error})))};case P:return a[i]?(c.fields[i].error=n.error,c.errors=c.errors||{},Y(c,"errors."+i,n.error),{v:$({},e,o({},u,$({},c)))}):{v:e}}}();return"object"===("undefined"==typeof s?"undefined":Z(s))?s.v:e},oe=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},ne=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"form";return t.connect(function(t){var o=t.formRed;return n({},r,V(o,""+e,{opts:{},fields:{},values:{}}))},function(t){return n({},r+"Actions",{formName:e,dispatch:t,create:function(r){return t(A(e,r))},destroy:function(){return t(w(e))},add:function(r,o,n){return t(N(e,r,o,n))},remove:function(r){return t(k(e,r))},set:function(r,o){return t(x(e,r,o))},setAll:function(r){return t(C(e,r))},touch:function(r){return t(U(e,r))},untouch:function(r){return t(D(e,r))},touchAll:function(){return t(L(e))},untouchAll:function(){return t(F(e))},reset:function(r){return t(q(e,r))},formError:function(r){return t(B(e,r))},fieldError:function(r,o){return t(H(e,r,o))}})},function(t,o,u){var i=r+"Actions",c=o[i],a=t[r],f=c.dispatch;return c.submit=function(r,t){r&&r.preventDefault&&r.preventDefault();var o="function"==typeof r?r:t;if(o=o||a.opts.onSubmit,"function"!=typeof o)throw Error("No onSubmit function given");c.touchAll(),c.formError(null),a.errors||(f(M(e)),o(a.values,c))},c.submitEnd=function(r,t){f(W(e,r,t));var o=a.opts,n=o.onSubmitError,u=o.onSubmitSuccess;return r||t?n(r,t):void u()},oe({},t,o,u,n({},i,c))})},ue=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},ie=function(){function e(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(r,t,o){return t&&e(r.prototype,t),o&&e(r,o),r}}(),ce=function(e){function r(){var e,t,o,n;u(this,r);for(var c=arguments.length,a=Array(c),f=0;f<c;f++)a[f]=arguments[f];return t=o=i(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(a))),o.valuesSet=!1,n=t,i(o,n)}return c(r,e),ie(r,[{key:"getChildContext",value:function(){var e=this.props,r=e.formActions,t=e.form,o=e.opts;return{formActions:r,form:t,opts:o}}},{key:"componentWillMount",value:function(){var e=this.props,r=e.formActions,t=e.opts;r.create(t)}},{key:"componentWillUnmount",value:function(){var e=this.props,r=e.formActions,t=e.opts;t.autoDestroy&&r.destroy()}},{key:"componentWillReceiveProps",value:function(e){var r=(e.wrappedProps,e.opts),t=e.formActions;if(!this.valuesSet){var o=V(r,"values");o&&(this.valuesSet=!0,t.setAll(o))}}},{key:"render",value:function(){var e=this.props,r=e.Wrapped,t=e.wrappedProps,o=e.form,n=e.formActions;return l.createElement(r,ue({},t,{form:o,formActions:n}))}}]),r}(r.Component);ce.propTypes={opts:r.PropTypes.object.isRequired,wrappedProps:r.PropTypes.object.isRequired},ce.childContextTypes={formActions:r.PropTypes.object,form:r.PropTypes.object,opts:r.PropTypes.object};var ae=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},fe=function(){function e(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(r,t,o){return t&&e(r.prototype,t),o&&e(r,o),r}}(),se=function(e){function r(e,t){a(this,r);var o=f(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));if(o.Wrapped=e.component,!t.form||!t.formActions||!t.opts)throw Error("Field must be inside a formRed() decorated component");return o}return s(r,e),fe(r,[{key:"componentWillReceiveProps",value:function(e){""+this.Wrapped!=""+e.component&&(this.Wrapped=e.component)}},{key:"componentWillMount",value:function(){var e=this.props,r=e.name,t=e.type,o=V(this.context.opts.values||{},r,K(t));this.context.formActions.add(r,o,t)}},{key:"render",value:function(){var e=this.Wrapped,r=this.context,t=r.form,o=r.formActions,n=r.opts,u=this.props,i=u.name,c=u.type,a=V(t,"fields",{})[i];return l.createElement(e,{extra:ae({form:t,formActions:o,error:V(t,"errors["+i+"])")},a),field:ae({},z(this.props,"component"),{value:V(t,"values["+i+"]",K(c))}),handlers:{onChange:function(e){return o.set(i,Q(e))},onFocus:function(){return!n.touchOnBlur&&o.touch(i)},onBlur:function(){return n.touchOnBlur&&o.touch(i)}}})}}]),r}(r.Component);se.propTypes={name:r.PropTypes.string.isRequired,type:r.PropTypes.string.isRequired,component:r.PropTypes.func.isRequired},se.contextTypes={formActions:r.PropTypes.object,form:r.PropTypes.object,opts:r.PropTypes.object};var le=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},pe=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return{}};return function(t){if(!e.name)throw Error("Form name required");e=le({autoDestroy:!0,touchOnBlur:!0,validate:function(){},onSubmitSuccess:function(){},onSubmitError:function(e,r){}},e);var o=ne(e.name)(ce);return o.displayName="formRed("+(t.displayName||t.name||"Component")+")",function(n){return e=le({},e,r(n)),l.createElement(o,{opts:e,Wrapped:t,wrappedProps:n})}}};e.actions=I,e.reducer=te,e.connectToForm=ne,e.Field=se,e.formRed=pe,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=form-red.min.js.map
